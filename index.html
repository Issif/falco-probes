<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <title>Falco Probes</title>
    <meta name="author" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="./js/dataTables.bootstrap.min.js"></script>
    <script type="text/javascript" src="./js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="./js/jquery.dataTables.min.js"></script>
    <script>
        var urlParams = new URLSearchParams(window.location.search);
        var searchString = urlParams.get('search')
        if (searchString == null) {
            searchString = "";
        };
        if (urlParams.get('falcoversion') != null) {
            $(document).ready(function(){
            $.getJSON("./data/"+urlParams.get('falcoversion')+".json", function( data ) {
                $('#probes').DataTable({
                    "oSearch": {"sSearch": searchString },
                    "paging": false,
                    "data" : data,
                    "order": [[ 6, "desc" ]],
                    columns : [
                        { "data" : "falco_version"},
                        { "data" : "architecture"},
                        { "data" : "kernel_version"},
                        { "data" : "hash"},
                        { "data" : "size"},
                        { "data" : "creation_date"},
                        { "data" : "link",  render: function ( data, type, row ) {
                                                return '<a href="'+data+'" download="'+data+'"><span class="glyphicon glyphicon-download-alt"></span></a>';
                                            }},
                        { "data" : "kernel_version", render: function ( data, type, row ) {
                                                return '<a href="./?falcoversion='+urlParams.get('falcoversion')+'&search='+data+'"><span class="glyphicon glyphicon-search"></span></a>';
                                            }},
                        ]
                    });
                });
            });
        }
    </script>
    </head>
    <body>
    <div id="releases">
        <img src="https://sysdig.com/wp-content/uploads/2018/10/Falco-horizontal-logo-teal_2x.png" height="55" alt="falco logo">
    </div>
    <br>
    <table id="probes" class="table table-striped table-condensed">
        <thead>
            <tr>
                <th>Falco Release</th>
                <th>Architecture</th> 
                <th>Kernel Version</th> 
                <th>Hash</th> 
                <th>Size</th> 
                <th>Creation Date</th> 
                <th>Download Link</th> 
                <th>Share Link</th>
            </tr>
        </thead>
    </table>
    </body>
    <script>
        $.getJSON('./data/index.json', function(data) {
            for (var key in data) {
                var spanelement = document.createElement('span');
                spanelement.className = "btn btn-link";
                var aelement = document.createElement('a');
                var linkText = document.createTextNode(key);
                aelement.appendChild(linkText);
                aelement.title = key;
                aelement.href = "?falcoversion="+key;
                spanelement.appendChild(aelement);
                document.getElementById("releases").appendChild(spanelement);
            }
        });
    </script>
</html>